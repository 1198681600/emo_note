# MoodTrace 情绪日记应用 - 需求文档

## 项目概述

**项目名称**: MoodTrace（情绪日记）  
**版本**: v1.0.0  
**开发平台**: Flutter  
**目标平台**: iOS
**后端技术**: Go + Gin + Claude AI  

### 产品定位
MoodTrace 是一款基于 AI 智能分析的情绪日记应用，帮助用户记录、分析和管理日常情绪变化，通过美观的视觉呈现和深入的情绪洞察，提升用户的情绪健康水平。

### 核心价值
- **智能情绪分析**: 基于 Claude AI 的16种情绪识别与深度分析
- **视觉化呈现**: 动态情绪渐变背景，直观展现情绪状态
- **数据驱动洞察**: 情绪统计分析，帮助用户了解情绪模式
- **个性化体验**: 根据用户情绪提供个性化建议和运势预测

---

## 功能模块详述

### 1. 用户认证系统

#### 1.1 功能描述
基于邮箱验证码的无密码登录系统，简化用户注册登录流程。

#### 1.2 核心功能
- **邮箱注册**: 用户通过邮箱地址注册账号
- **验证码登录**: 使用6位数字验证码进行登录验证
- **用户信息管理**: 支持昵称、头像、年龄、性别、职业等信息设置
- **会话管理**: JWT Token 认证，24小时有效期

#### 1.3 页面结构
- `WelcomePage`: 应用启动欢迎页
- `RegisterPage`: 用户注册页面
- `LoginPage`: 用户登录页面
- `VerifyEmailPage`: 邮箱验证页面
- `ProfileEditPage`: 个人信息编辑页面

#### 1.4 技术实现
- **前端**: Flutter + Riverpod 状态管理
- **后端**: Go + Gin 框架
- **认证**: JWT Token + 邮箱验证码
- **文件上传**: Cloudflare R2 存储

### 2. 情绪日记系统

#### 2.1 功能描述
用户可以记录每日的情绪状态和心情感受，系统自动进行 AI 情绪分析。

#### 2.2 核心功能
- **日记创建**: 每日一篇，支持富文本编辑
- **智能情绪分析**: 基于 Claude AI 的16种情绪自动识别
- **情绪可视化**: 动态渐变背景实时展现情绪状态
- **历史记录管理**: 支持查看、编辑、删除历史日记

#### 2.3 页面结构
- `DiaryEditPage`: 日记编辑页面
- `DiaryListPage`: 历史日记列表
- `DiaryDetailPage`: 日记详情页面

#### 2.4 情绪分析特性
- **16种情绪类型**: 开心、快乐、兴奋、平静、放松、满足、难过、沮丧、焦虑、紧张、愤怒、烦躁、感动、温暖、孤独、迷茫
- **情绪强度**: 0.0-1.0 的强度评分
- **时间段分析**: 上午、中午、下午、晚上的情绪变化
- **个性化洞察**: 基于用户背景的情绪分析和建议

### 3. 智能背景系统

#### 3.1 功能描述
根据用户的情绪分析结果，动态生成对应的渐变背景效果。

#### 3.2 渐变类型
- **径向渐变** (Radial): 单一情绪的强度表现
- **时间流动** (TimeFlow): 双情绪的时间变化
- **一日轮回** (DayCircle): 多种情绪的复杂表现
- **多焦点渐变** (MultiPoint): 4+种情绪的复合展现
- **对角线渐变** (Diagonal): 情绪对比表现

#### 3.3 技术实现
- **动画引擎**: Flutter CustomPainter + AnimationController
- **色彩映射**: 16种情绪对应的专属色彩
- **动态切换**: 4秒循环动画，平滑过渡效果

### 4. 情绪统计分析

#### 4.1 功能描述
基于历史日记数据，提供多维度的情绪统计分析和可视化图表。

#### 4.2 统计维度
- **情绪分布**: 饼图展示各种情绪占比
- **情绪趋势**: 折线图展示情绪变化趋势
- **TOP3排行**: 最常出现的情绪排行榜
- **时间段分析**: 7天、30天、全部时间的数据对比

#### 4.3 页面结构
- `EmotionStatisticsPage`: 情绪统计主页面
- Tab切换式布局：分布、趋势、TOP3

#### 4.4 技术实现
- **图表库**: FL Chart
- **数据处理**: 本地情绪数据聚合分析
- **交互设计**: 支持时间段筛选和详细数据展示

### 5. 分享功能

#### 5.1 功能描述
用户可以将日记和情绪状态生成精美卡片进行分享。

#### 5.2 分享类型
- **情绪卡片分享**: 生成带有渐变背景的情绪卡片
- **应用推荐分享**: 分享应用下载链接
- **保存到相册**: 将卡片保存到手机相册

#### 5.3 技术实现
- **卡片生成**: Flutter CustomPainter 绘制
- **分享组件**: SharePlus 插件
- **相册保存**: ImageGallerySaver 插件

### 6. 今日运势功能

#### 6.1 功能描述
为用户提供每日的运势预测，包括综合运势、爱情、事业、财运、健康等维度。

#### 6.2 运势内容
- **综合运势**: 总体运势评分和描述
- **分类运势**: 爱情、事业、财运、健康四个维度
- **幸运元素**: 幸运颜色、数字、方位
- **每日建议**: 个性化的行动建议

#### 6.3 技术实现
- **数据来源**: 本地算法生成（可扩展为API服务）
- **UI设计**: 模态对话框展示，支持滚动查看

---

## 技术架构

### 前端架构
```
Flutter App
├── Pages (页面层)
│   ├── Auth (认证相关)
│   ├── Home (主页)
│   ├── Diary (日记相关)
│   ├── Emotion (情绪统计)
│   └── Profile (个人信息)
├── Widgets (通用组件)
│   ├── EmotionGradientBackground (情绪背景)
│   ├── EmotionTestButton (测试按钮)
│   ├── DiaryShareCard (分享卡片)
│   └── AvatarUploadWidget (头像上传)
├── Services (业务服务)
│   ├── ApiService (API调用)
│   ├── EmotionService (情绪分析)
│   ├── ShareService (分享服务)
│   └── FortuneService (运势服务)
├── Providers (状态管理)
│   ├── AuthProvider (认证状态)
│   ├── DiaryProvider (日记状态)
│   └── EmotionProvider (情绪状态)
└── Models (数据模型)
    ├── User (用户模型)
    └── Diary (日记模型)
```

### 后端架构
```
Go Backend
├── API Routes
│   ├── /api/auth/* (认证相关)
│   ├── /api/diary/* (日记CRUD)
│   ├── /api/emotion/* (情绪分析)
│   ├── /api/profile (用户信息)
│   └── /api/upload/* (文件上传)
├── Database (PostgreSQL)
│   ├── users (用户表)
│   ├── diaries (日记表)
│   ├── email_verifications (邮箱验证)
│   └── user_sessions (用户会话)
└── External Services
    ├── Claude AI (情绪分析)
    ├── Cloudflare R2 (文件存储)
    └── SMTP (邮件服务)
```

---

## 用户体验流程

### 首次使用流程
1. **启动应用** → 欢迎页面展示
2. **用户注册** → 邮箱验证 → 登录成功
3. **完善信息** → 设置昵称、头像等个人信息
4. **记录日记** → 写下第一篇情绪日记
5. **查看分析** → 观看 AI 情绪分析结果和渐变背景

### 日常使用流程
1. **打开应用** → 自动登录 → 主页展示
2. **查看运势** → 点击"今日运势"了解当日运程
3. **记录心情** → 点击"记录心情"写日记
4. **实时分析** → 保存后立即获得情绪分析
5. **统计查看** → 定期查看情绪统计和趋势
6. **分享互动** → 生成情绪卡片分享给朋友

---

## 核心算法

### 情绪分析算法
基于 Claude AI 的自然语言处理，通过以下步骤进行情绪分析：

1. **文本预处理**: 清理和格式化用户输入的日记内容
2. **情绪识别**: 使用预训练模型识别文本中的情绪类型
3. **强度计算**: 计算每种情绪的强度值（0.0-1.0）
4. **时间段分析**: 根据时间词汇判断情绪发生的时段
5. **洞察生成**: 基于情绪组合生成个性化洞察和建议

### 渐变背景算法
根据情绪分析结果，动态生成对应的渐变效果：

1. **颜色映射**: 将情绪类型映射为对应的色彩值
2. **渐变类型选择**: 根据情绪数量选择合适的渐变类型
3. **动画参数计算**: 计算渐变的起始点、终点和动画时长
4. **实时渲染**: 使用 CustomPainter 实时绘制渐变效果

---

## 数据安全与隐私

### 数据加密
- **传输加密**: 所有 API 请求使用 HTTPS 协议
- **存储加密**: 敏感数据在数据库中加密存储
- **Token安全**: JWT Token 包含过期时间，定期刷新

### 隐私保护
- **数据最小化**: 只收集必要的用户信息
- **本地存储**: 情绪分析结果优先本地缓存
- **用户控制**: 用户可随时删除个人数据
- **透明度**: 明确告知数据使用目的和范围

---

## 性能优化

### 前端优化
- **懒加载**: 图片和页面组件按需加载
- **状态管理**: 使用 Riverpod 进行高效状态管理
- **缓存策略**: 网络图片和API响应智能缓存
- **动画优化**: 使用硬件加速和GPU渲染

### 后端优化
- **数据库优化**: 合理的索引设计和查询优化
- **API缓存**: 高频API接口使用Redis缓存
- **异步处理**: 情绪分析等耗时操作异步处理
- **负载均衡**: 支持水平扩展和负载均衡

---

## 扩展规划

### 短期扩展 (v1.1)
- **情绪提醒**: 基于历史数据的情绪异常提醒
- **主题定制**: 更多背景主题和色彩方案
- **数据导出**: 支持导出日记和统计数据
- **多语言支持**: 英文界面和国际化

### 中期扩展 (v2.0)
- **AI聊天助手**: 基于情绪状态的智能对话
- **群组功能**: 朋友圈分享和互动
- **专业分析**: 心理健康专业报告
- **可穿戴设备集成**: 智能手表数据同步

### 长期规划 (v3.0)
- **VR/AR体验**: 沉浸式情绪体验
- **AI个性化**: 深度学习用户情绪模式
- **健康生态**: 与其他健康应用数据互通
- **企业版本**: 团队情绪健康管理


## 项目里程碑

### 已完成功能 ✅
- [x] 用户认证系统（注册、登录、信息管理）
- [x] 情绪日记 CRUD 功能
- [x] Claude AI 情绪分析集成
- [x] 动态情绪渐变背景系统
- [x] 情绪统计分析（分布、趋势、TOP3）
- [x] 日记分享功能
- [x] 今日运势功能
- [x] 头像上传功能
- [x] 历史记录管理

### 待优化项目 📋
- [ ] 性能优化和用户体验提升
- [ ] 错误处理和异常情况优化
- [ ] 单元测试和集成测试
- [ ] 应用发布和部署流程
- [ ] 用户反馈收集机制

